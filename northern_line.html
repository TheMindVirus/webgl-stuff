<title>northern_line</title>
<script id='data' type='application/json'>
{
  {
    { 'id': 'A01', 'cx':  780, 'cy':   85, 'nb': 'Edgware' },
    { 'id': 'A02', 'cx':  805, 'cy':  100, 'nb': 'Burnt Oak' },
    { 'id': 'A03', 'cx':  825, 'cy':  115, 'nb': 'Colindale' },
    { 'id': 'A04', 'cx':  845, 'cy':  130, 'nb': 'Hendon Central' },
    { 'id': 'A05', 'cx':  865, 'cy':  145, 'nb': 'Brent Cross' },
    { 'id': 'A06', 'cx':  885, 'cy':  155, 'nb': 'Golders Green' },
    { 'id': 'A07', 'cx':  905, 'cy':  170, 'nb': 'Hampstead' },
    { 'id': 'A08', 'cx':  950, 'cy':  200, 'nb': 'Belsize Park' },
    { 'id': 'A09', 'cx':  970, 'cy':  215, 'nb': 'Chalk Farm' },
    { 'id': 'A10', 'cx':  990, 'cy':  235, 'nb': 'Camden Town' },
    { 'id': 'A11', 'cx':  980, 'cy':  255, 'nb': 'Mornington Crescent' },
    { 'id': 'A12', 'cx':  992, 'cy':  288, 'nb': 'Euston' },
    { 'id': 'A13', 'cx':  960, 'cy':  315, 'nb': 'Warren Street' },
    { 'id': 'A14', 'cx':  960, 'cy':  352, 'nb': 'Goodge Street' },
    { 'id': 'A15', 'cx':  960, 'cy':  367, 'nb': 'Tottenham Court Road' },
    { 'id': 'A16', 'cx':  960, 'cy':  395, 'nb': 'Leicester Square' },
    { 'id': 'A17', 'cx':  960, 'cy':  430, 'nb': 'Charing Cross' },
    { 'id': 'A18', 'cx':  960, 'cy':  455, 'nb': 'Embankment' },
    { 'id': 'A19', 'cx':  960, 'cy':  486, 'nb': 'Waterloo' },
    { 'id': 'A20', 'cx':  957, 'cy':  590, 'nb': 'Kennington' },
    { 'id': 'A21', 'cx':  943, 'cy':  597, 'nb': 'Oval' },
    { 'id': 'A22', 'cx':  928, 'cy':  610, 'nb': 'Stockwell' },
    { 'id': 'A23', 'cx':  912, 'cy':  618, 'nb': 'Clapham North' },
    { 'id': 'A24', 'cx':  890, 'cy':  632, 'nb': 'Clapham Common' },
    { 'id': 'A25', 'cx':  870, 'cy':  645, 'nb': 'Clapham South' },
    { 'id': 'A26', 'cx':  852, 'cy':  660, 'nb': 'Baltham' },
    { 'id': 'A27', 'cx':  832, 'cy':  672, 'nb': 'Tooting Bec' },
    { 'id': 'A28', 'cx':  812, 'cy':  687, 'nb': 'Tooting Broadway' },
    { 'id': 'A29', 'cx':  792, 'cy':  700, 'nb': 'Colliers Wood' },
    { 'id': 'A30', 'cx':  772, 'cy':  712, 'nb': 'South Wimbledon' },
    { 'id': 'A31', 'cx':  752, 'cy':  730, 'nb': 'Morden' },

    { 'id': 'A32', 'cx': 1041, 'cy':   38, 'nb': 'High Barnet' },
    { 'id': 'A33', 'cx': 1041, 'cy':   52, 'nb': 'Totteridge & Whetstone' },
    { 'id': 'A34', 'cx': 1041, 'cy':   67, 'nb': 'Woodside Park' },
    { 'id': 'A35', 'cx': 1041, 'cy':   82, 'nb': 'West Finchley' },

    { 'id': 'A36', 'cx': 1012, 'cy':   75, 'nb': 'Mill Hill East' },

    { 'id': 'A37', 'cx': 1041, 'cy':  105, 'nb': 'Finchley Central' },
    { 'id': 'A38', 'cx': 1041, 'cy':  115, 'nb': 'East Finchley' },
    { 'id': 'A39', 'cx': 1041, 'cy':  135, 'nb': 'Highgate' },
    { 'id': 'A40', 'cx': 1041, 'cy':  150, 'nb': 'Archway' },
    { 'id': 'A41', 'cx': 1041, 'cy':  169, 'nb': 'Tufnell Park' },
    { 'id': 'A42', 'cx': 1041, 'cy':  186, 'nb': 'Kentish Town' },
    { 'id': 'A43', 'cx': 1051, 'cy':  302, 'nb': 'King's Cross St Pancras' },
    { 'id': 'A44', 'cx': 1096, 'cy':  295, 'nb': 'Angel' },
    { 'id': 'A45', 'cx': 1134, 'cy':  311, 'nb': 'Old Street' },
    { 'id': 'A46', 'cx': 1134, 'cy':  344, 'nb': 'Moorgate' },
    { 'id': 'A47', 'cx': 1134, 'cy':  397, 'nb': 'Bank' },
    { 'id': 'A48', 'cx': 1134, 'cy':  462, 'nb': 'London Bridge' },
    { 'id': 'A49', 'cx': 1047, 'cy':  530, 'nb': 'Borough' },
    { 'id': 'A50', 'cx':  993, 'cy':  565, 'nb': 'Elephant & Castle' }
  },
  {
    { 'a': 'A01', 'b': 'A02' },
    { 'a': 'A02', 'b': 'A03' },
    { 'a': 'A03', 'b': 'A04' },
    { 'a': 'A04', 'b': 'A05' },
    { 'a': 'A05', 'b': 'A06' },
    { 'a': 'A06', 'b': 'A07' },
    { 'a': 'A07', 'b': 'A08' },
    { 'a': 'A08', 'b': 'A09' },
    { 'a': 'A09', 'b': 'A10' },
    { 'a': 'A10', 'b': 'A11' },
    { 'a': 'A11', 'b': 'A12' },
    { 'a': 'A12', 'b': 'A13' },
    { 'a': 'A13', 'b': 'A14' },
    { 'a': 'A14', 'b': 'A15' },
    { 'a': 'A15', 'b': 'A16' },
    { 'a': 'A16', 'b': 'A17' },
    { 'a': 'A17', 'b': 'A18' },
    { 'a': 'A18', 'b': 'A19' },
    { 'a': 'A19', 'b': 'A20' },
    { 'a': 'A20', 'b': 'A21' },
    { 'a': 'A21', 'b': 'A22' },
    { 'a': 'A22', 'b': 'A23' },
    { 'a': 'A23', 'b': 'A24' },
    { 'a': 'A24', 'b': 'A25' },
    { 'a': 'A25', 'b': 'A26' },
    { 'a': 'A26', 'b': 'A27' },
    { 'a': 'A27', 'b': 'A28' },
    { 'a': 'A28', 'b': 'A29' },
    { 'a': 'A29', 'b': 'A30' },
    { 'a': 'A30', 'b': 'A31' },

    { 'a': 'A32', 'b': 'A33' },
    { 'a': 'A33', 'b': 'A34' },
    { 'a': 'A34', 'b': 'A35' },
    { 'a': 'A35', 'b': 'A37' },

    { 'a': 'A36', 'b': 'A37' },

    { 'a': 'A37', 'b': 'A38' },
    { 'a': 'A38', 'b': 'A39' },
    { 'a': 'A39', 'b': 'A40' },
    { 'a': 'A40', 'b': 'A41' },
    { 'a': 'A41', 'b': 'A42' },

    { 'a': 'A42', 'b': 'A10' },
    { 'a': 'A10', 'b': 'A12' },
    { 'a': 'A12', 'b': 'A43' },

    { 'a': 'A43', 'b': 'A44' },
    { 'a': 'A44', 'b': 'A45' },
    { 'a': 'A45', 'b': 'A46' },
    { 'a': 'A46', 'b': 'A47' },
    { 'a': 'A47', 'b': 'A48' },
    { 'a': 'A48', 'b': 'A49' },
    { 'a': 'A49', 'b': 'A50' },
    { 'a': 'A50', 'b': 'A20' }
  }
}
</script>
<script>
svg = null;
data = null;
node = null;
link = null;
reviver = function(key, value)
{
    var raw = document.getElementById('data').innerText;
    var c39 = String.fromCharCode(39);
    var c34 = String.fromCharCode(34);
    var rare = '__|||__';
    raw = raw.replaceAll(c39 + 's', rare + 's');
    raw = raw.replaceAll(c39, c34);
    raw = raw.replaceAll(' {', ' ' + c34 + '__' + rare + '__' + c34 + ': {');
    raw = raw.replaceAll(rare + 's', c39 + 's');
    var count = raw.split('|||').length - 1;
    for (var i = 0; i < count; ++i) { raw = raw.replace(rare, i); }
    //console.log(raw);
    //console.log(count);
    return JSON.parse(raw);
}
lookup = function(id, data, data_keys, field = 'id')
{
    for (var i = 0; i < data_keys.length; ++i)
    {
        if (data[data_keys[i]][field] == id) { return i; }
    }
}
print = function(msg, indent = 0)
{
    var tab = '| - ';
    if (indent > 0) { for (var i = 0; i < indent; ++i) { tab = '  ' + tab; } }
    console.log(tab + '%c' + msg, 'color: #f57');
}
vicinity = function(idx, level = 3, depth = 0, prev = null)
{
    if (depth > level) { return; }
    var node_keys = Object.keys(node);
    var id = lookup(idx, node, node_keys);
    if (id != null)
    {
        print(node[node_keys[id]]['nb'], depth);
        var link_keys = Object.keys(link);
        for (var i = 0; i < link_keys.length; ++i)
        {
            var idy = null;
            var ida = link[link_keys[i]]['a'];
            var idb = link[link_keys[i]]['b'];
            if (ida == idx) { idy = idb; }
            else if (idb == idx) { idy = ida; }
            //console.log(ida, idb, idx, idy, depth, (idy != null), (idy != idx), (idy != prev));
            if ((idy != null) && (idy != idx) && (idy != prev)) { vicinity(idy, level, depth + 1, idx); }
        }
    }
}
window.onload = function()
{
    svg = document.getElementsByTagName('svg')[0];
    data = JSON.parse('{}', reviver);
    var data_keys = Object.keys(data);
    node = data[data_keys[0]];
    link = data[data_keys[1]];
    //console.log(data);
    //console.log(node);
    //console.log(link);
    var node_keys = Object.keys(node);
    var link_keys = Object.keys(link);
    for (var i = 0; i < link_keys.length; ++i)
    {
        var ida = link[link_keys[i]]['a'];
        var idb = link[link_keys[i]]['b'];
        var idx = lookup(ida, node, node_keys);
        var idy = lookup(idb, node, node_keys);

        //console.log(ida, idb, idx, idy);

        var x1 = node[node_keys[idx]]['cx'];
        var y1 = node[node_keys[idx]]['cy'];
        var x2 = node[node_keys[idy]]['cx'];
        var y2 = node[node_keys[idy]]['cy'];

        var via = document.createElement('path');
        via.setAttribute('id', 'link' + i);
        via.setAttribute('name', node[node_keys[idx]].id + '_x_' + node[node_keys[idy]].id);
        via.setAttribute('d', 'M ' + x1 + ',' + y1 + ' L ' + x2 + ',' + y2 + ' Z');
        via.setAttribute('fill', 'none');
        via.setAttribute('stroke', '#f03');
        via.setAttribute('stroke-width', 3);
        via.setAttribute('stroke-linecap', 'round');
        via.setAttribute('stroke-linejoin', 'round');

        svg.appendChild(via);
    }
    for (var i = 0; i < node_keys.length; ++i)
    {
        var pin = document.createElement('g');
        pin.setAttribute('id', node[node_keys[i]].id);
        pin.setAttribute('name', node[node_keys[i]].nb);
        pin.setAttribute('x', node[node_keys[i]].cx);
        pin.setAttribute('y', node[node_keys[i]].cy);

        var ico = document.createElement('circle');
        ico.setAttribute('cx', node[node_keys[i]].cx);
        ico.setAttribute('cy', node[node_keys[i]].cy);
        ico.setAttribute('r', '6');
        ico.setAttribute('fill', '#3333');
        ico.setAttribute('stroke', '#f04');
        ico.setAttribute('stroke-width', '1');
        ico.setAttribute('onclick', 'vicinity(this.parentElement.id);');
        pin.appendChild(ico);

        var txt = document.createElement('text');
        txt.innerText = node[node_keys[i]].nb;
        txt.setAttribute('x', node[node_keys[i]].cx);
        txt.setAttribute('y', node[node_keys[i]].cy - 10);
        txt.setAttribute('fill', '#fff');
        txt.setAttribute('font-family', 'sans-serif');
        txt.setAttribute('font-size', '6pt');
        txt.setAttribute('font-weight', 'bold');
        txt.setAttribute('text-anchor', 'middle');
        pin.appendChild(txt);

        svg.appendChild(pin);
    }
    
    svg.innerHTML = svg.innerHTML;
}
point = function(element, mode)
{
    var rect = element.getBoundingClientRect();
    if (mode == 1) { return { x: rect.left + 6, y: rect.top + 6 }; }
    else if (mode == 2) { return { x: rect.left + 6, y: rect.top + 6 }; }
    else { return rect; }
}
</script>
<style>
 body { background: #113; color: #fff; }
 svg { position: absolute; top: 0; left: 0; width: 100%; height: 100%; user-select: none; }
</style>
<svg></svg>